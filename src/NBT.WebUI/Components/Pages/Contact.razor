@page "/contact"
@rendermode @(new Microsoft.AspNetCore.Components.Web.InteractiveServerRenderMode(prerender: false))
@using NBT.WebUI.Services
@using NBT.WebUI.Models
@inject IContactInquiryService ContactInquiryService

<PageTitle>Contact Us - National Benchmark Tests</PageTitle>

<FluentStack Orientation="Orientation.Vertical" VerticalGap="24">
    <FluentBreadcrumb>
        <FluentBreadcrumbItem Href="/">Home</FluentBreadcrumbItem>
        <FluentBreadcrumbItem Href="/contact">Contact Us</FluentBreadcrumbItem>
    </FluentBreadcrumb>

    <h1>Contact Us</h1>

    <FluentGrid>
        <FluentGridItem xs="12" md="6">
            <FluentCard>
                <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
                    <h2>Send Us a Message</h2>
                    
                    @if (submissionSuccess)
                    {
                        <FluentMessageBar Intent="MessageIntent.Success">
                            <strong>Message Sent Successfully!</strong><br />
                            Your inquiry has been received. Reference number: <strong>@referenceNumber</strong><br />
                            We'll respond to your inquiry shortly.
                        </FluentMessageBar>
                    }
                    else if (submissionError)
                    {
                        <FluentMessageBar Intent="MessageIntent.Error">
                            <strong>Error:</strong> Failed to submit your inquiry. Please try again.
                        </FluentMessageBar>
                    }
                    
                    <FluentTextField @bind-Value="@ContactForm.Name" Label="Name *" Required="true" Style="width: 100%;" />
                    <FluentTextField @bind-Value="@ContactForm.Email" Label="Email *" Required="true" Style="width: 100%;" />
                    <FluentTextField @bind-Value="@ContactForm.PhoneNumber" Label="Phone (Optional)" Style="width: 100%;" />
                    <FluentTextField @bind-Value="@ContactForm.Subject" Label="Subject *" Required="true" Style="width: 100%;" />
                    <FluentTextArea @bind-Value="@ContactForm.Message" Label="Message *" Required="true" Rows="5" Style="width: 100%;" />
                    
                    <FluentButton Appearance="Appearance.Accent" OnClick="@SubmitForm" Disabled="@isSubmitting">
                        @if (isSubmitting)
                        {
                            <FluentProgressRing Style="width: 20px; height: 20px;" />
                            <span>Sending...</span>
                        }
                        else
                        {
                            <span>Send Message</span>
                        }
                    </FluentButton>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>

        <FluentGridItem xs="12" md="6">
            <FluentCard>
                <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
                    <h2>Contact Information</h2>
                    <FluentStack Orientation="Orientation.Horizontal" VerticalGap="8">
                        <div>
                            <strong>üìß Email:</strong><br />
                            info@nbt.ac.za
                        </div>
                    </FluentStack>
                    <FluentStack Orientation="Orientation.Horizontal" VerticalGap="8">
                        <div>
                            <strong>üìû Phone:</strong><br />
                            +27 (0) 21 650 3523
                        </div>
                    </FluentStack>
                    <FluentStack Orientation="Orientation.Horizontal" VerticalGap="8">
                        <div>
                            <strong>üìç Address:</strong><br />
                            Centre for Educational Testing for Access and Placement<br />
                            University of Cape Town<br />
                            Private Bag X1<br />
                            Rondebosch 7701<br />
                            South Africa
                        </div>
                    </FluentStack>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>
    </FluentGrid>
</FluentStack>

@code {
    private CreateContactInquiryDto ContactForm = new();
    private bool isSubmitting = false;
    private bool submissionSuccess = false;
    private bool submissionError = false;
    private string referenceNumber = string.Empty;

    private async Task SubmitForm()
    {
        if (string.IsNullOrWhiteSpace(ContactForm.Name) || 
            string.IsNullOrWhiteSpace(ContactForm.Email) ||
            string.IsNullOrWhiteSpace(ContactForm.Subject) ||
            string.IsNullOrWhiteSpace(ContactForm.Message))
        {
            return;
        }

        isSubmitting = true;
        submissionSuccess = false;
        submissionError = false;

        var result = await ContactInquiryService.SubmitInquiryAsync(ContactForm);

        if (result != null)
        {
            submissionSuccess = true;
            referenceNumber = result.ReferenceNumber;
            
            // Reset form
            ContactForm = new CreateContactInquiryDto();
        }
        else
        {
            submissionError = true;
        }

        isSubmitting = false;
    }
}
