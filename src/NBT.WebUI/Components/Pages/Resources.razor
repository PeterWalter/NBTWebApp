@page "/resources"
@using NBT.WebUI.Services
@using NBT.WebUI.Models
@inject IResourceService ResourceService

<PageTitle>Resources - National Benchmark Tests</PageTitle>

<FluentStack Orientation="Orientation.Vertical" VerticalGap="24">
    <FluentBreadcrumb>
        <FluentBreadcrumbItem Href="/">Home</FluentBreadcrumbItem>
        <FluentBreadcrumbItem Href="/resources">Resources</FluentBreadcrumbItem>
    </FluentBreadcrumb>

    <h1>Resources & Downloads</h1>

    <!-- Quick Links -->
    <FluentGrid Spacing="3">
        <FluentGridItem xs="12" sm="6" md="3">
            <FluentCard Height="100%" Style="text-align: center; padding: 1.5rem; cursor: pointer;">
                <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                    <div style="font-size: 3rem;">üìù</div>
                    <h4>Sample Tests</h4>
                    <p style="font-size: 0.9rem;">Practice questions for all test types</p>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>

        <FluentGridItem xs="12" sm="6" md="3">
            <FluentCard Height="100%" Style="text-align: center; padding: 1.5rem; cursor: pointer;">
                <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                    <div style="font-size: 3rem;">üìö</div>
                    <h4>Study Guides</h4>
                    <p style="font-size: 0.9rem;">Preparation and study materials</p>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>

        <FluentGridItem xs="12" sm="6" md="3">
            <FluentCard Height="100%" Style="text-align: center; padding: 1.5rem; cursor: pointer;">
                <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                    <div style="font-size: 3rem;">üìÑ</div>
                    <h4>Publications</h4>
                    <p style="font-size: 0.9rem;">Research reports and articles</p>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>

        <FluentGridItem xs="12" sm="6" md="3">
            <FluentCard Height="100%" Style="text-align: center; padding: 1.5rem; cursor: pointer;">
                <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                    <div style="font-size: 3rem;">üé•</div>
                    <h4>Videos</h4>
                    <p style="font-size: 0.9rem;">Tutorial videos and guides</p>
                </FluentStack>
            </FluentCard>
        </FluentGridItem>
    </FluentGrid>

    <!-- Sample Tests and Practice Materials -->
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            <h2>üìù Sample Tests & Practice Materials</h2>
            <FluentDivider />
            <p>
                Download sample tests to familiarize yourself with the format and types of questions 
                used in the NBT.
            </p>

            @if (isLoading)
            {
                <FluentProgressRing />
                <p>Loading resources...</p>
            }
            else if (sampleTests.Any())
            {
                <FluentAccordion>
                    @foreach (var resource in sampleTests)
                    {
                        <FluentAccordionItem Heading="@resource.Title" Expanded="@(resource == sampleTests.First())">
                            <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                                <p>@resource.Description</p>
                                <FluentStack Orientation="Orientation.Horizontal" HorizontalGap="10" Wrap="true">
                                    <FluentButton Appearance="Appearance.Accent" OnClick="@(() => DownloadResource(resource.Id, resource.DownloadUrl))">
                                        ‚¨áÔ∏è Download (@FormatFileSize(resource.FileSizeBytes))
                                    </FluentButton>
                                    <p style="color: gray; font-size: 0.9rem;">Downloaded @resource.DownloadCount times</p>
                                </FluentStack>
                            </FluentStack>
                        </FluentAccordionItem>
                    }
                </FluentAccordion>
            }
            else
            {
                <FluentAccordion>
                    <FluentAccordionItem Heading="Academic Literacy (AL) Sample Test" Expanded="true">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <p>
                                This sample test provides examples of the types of questions you will encounter 
                                in the Academic Literacy test. It includes reading comprehension passages, 
                                reasoning questions, and language use items.
                            </p>
                            <FluentStack Orientation="Orientation.Horizontal" HorizontalGap="10" Wrap="true">
                                <FluentButton Appearance="Appearance.Accent">
                                    ‚¨áÔ∏è Download Sample Test (PDF)
                                </FluentButton>
                                <FluentButton Appearance="Appearance.Outline">
                                    ‚¨áÔ∏è Download Answer Key (PDF)
                                </FluentButton>
                            </FluentStack>
                        </FluentStack>
                    </FluentAccordionItem>
                    <FluentAccordionItem Heading="Quantitative Literacy (QL) Sample Test">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <p>
                                Sample questions demonstrating the quantitative literacy skills assessed, 
                                including data interpretation, basic calculations, and problem-solving in 
                                real-world contexts.
                            </p>
                            <FluentStack Orientation="Orientation.Horizontal" HorizontalGap="10" Wrap="true">
                                <FluentButton Appearance="Appearance.Accent">
                                    ‚¨áÔ∏è Download Sample Test (PDF)
                                </FluentButton>
                                <FluentButton Appearance="Appearance.Outline">
                                    ‚¨áÔ∏è Download Answer Key (PDF)
                                </FluentButton>
                            </FluentStack>
                        </FluentStack>
                    </FluentAccordionItem>
                    <FluentAccordionItem Heading="Mathematics (MAT) Sample Test">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <p>
                                Practice questions covering the mathematical content assessed in the NBT Mathematics 
                                test, including algebra, geometry, data handling, and problem-solving.
                            </p>
                            <FluentStack Orientation="Orientation.Horizontal" HorizontalGap="10" Wrap="true">
                                <FluentButton Appearance="Appearance.Accent">
                                    ‚¨áÔ∏è Download Sample Test (PDF)
                                </FluentButton>
                                <FluentButton Appearance="Appearance.Outline">
                                    ‚¨áÔ∏è Download Answer Key (PDF)
                                </FluentButton>
                            </FluentStack>
                        </FluentStack>
                    </FluentAccordionItem>
                </FluentAccordion>
            }
        </FluentStack>
    </FluentCard>

    <!-- Study and Preparation Guides -->
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            <h2>üìö Study & Preparation Guides</h2>
            <FluentDivider />
            
            <FluentGrid Spacing="3">
                <FluentGridItem xs="12" md="6">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <h4>Candidate Information Brochure</h4>
                            <p>
                                Comprehensive guide covering registration, test format, what to expect on 
                                test day, and understanding your results.
                            </p>
                            <FluentButton Appearance="Appearance.Accent">
                                ‚¨áÔ∏è Download Brochure (PDF)
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" md="6">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <h4>Test Preparation Tips</h4>
                            <p>
                                Practical advice on how to prepare for the NBT, including reading strategies, 
                                study techniques, and test-taking tips.
                            </p>
                            <FluentButton Appearance="Appearance.Accent">
                                ‚¨áÔ∏è Download Guide (PDF)
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" md="6">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <h4>Mathematical Skills Refresher</h4>
                            <p>
                                Review of key mathematical concepts tested in the MAT, with examples and 
                                practice problems.
                            </p>
                            <FluentButton Appearance="Appearance.Accent">
                                ‚¨áÔ∏è Download Refresher (PDF)
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" md="6">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
                            <h4>Academic Reading Strategies</h4>
                            <p>
                                Techniques for improving academic reading comprehension and critical analysis 
                                skills.
                            </p>
                            <FluentButton Appearance="Appearance.Accent">
                                ‚¨áÔ∏è Download Guide (PDF)
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>
            </FluentGrid>
        </FluentStack>
    </FluentCard>

    <!-- Research Publications -->
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            <h2>üìÑ Research Publications</h2>
            <FluentDivider />
            <p>
                CETAP conducts ongoing research on academic preparedness, assessment, and student success. 
                Publications are available for educators, researchers, and institutional stakeholders.
            </p>

            <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
                <div>
                    <h4>Annual Report 2023</h4>
                    <p>
                        Comprehensive report on NBT activities, research findings, and statistical data 
                        for the 2023 academic year.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Report (PDF)
                    </FluentButton>
                </div>

                <FluentDivider />

                <div>
                    <h4>Predictive Validity Studies</h4>
                    <p>
                        Research on the relationship between NBT scores and academic performance at 
                        South African universities.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Publication (PDF)
                    </FluentButton>
                </div>

                <FluentDivider />

                <div>
                    <h4>Technical Report: Test Development and Validation</h4>
                    <p>
                        Detailed information on NBT test construction, psychometric properties, and 
                        validation procedures.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Report (PDF)
                    </FluentButton>
                </div>

                <FluentDivider />

                <div>
                    <h4>Academic Literacy and Student Success</h4>
                    <p>
                        Research exploring the role of academic literacy in higher education success 
                        and implications for teaching and support.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Publication (PDF)
                    </FluentButton>
                </div>
            </FluentStack>

            <FluentButton Appearance="Appearance.Outline">
                View All Publications
            </FluentButton>
        </FluentStack>
    </FluentCard>

    <!-- For Educators -->
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            <h2>üë®‚Äçüè´ For Educators</h2>
            <FluentDivider />
            
            <FluentGrid Spacing="3">
                <FluentGridItem xs="12" md="6">
                    <h4>Workshop Presentation Materials</h4>
                    <p>
                        PowerPoint presentations and handouts for conducting NBT information sessions 
                        with students and parents.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Materials (ZIP)
                    </FluentButton>
                </FluentGridItem>

                <FluentGridItem xs="12" md="6">
                    <h4>Educator's Guide to the NBT</h4>
                    <p>
                        Comprehensive guide for educators on advising students about the NBT, interpreting 
                        results, and supporting student preparation.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Guide (PDF)
                    </FluentButton>
                </FluentGridItem>
            </FluentGrid>
        </FluentStack>
    </FluentCard>

    <!-- For Institutions -->
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            <h2>üèõÔ∏è For Institutions</h2>
            <FluentDivider />
            
            <FluentGrid Spacing="3">
                <FluentGridItem xs="12" md="6">
                    <h4>Technical Documentation</h4>
                    <p>
                        Detailed technical information on test construction, scoring, benchmarking, 
                        and result interpretation for institutional use.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Documentation (PDF)
                    </FluentButton>
                </FluentGridItem>

                <FluentGridItem xs="12" md="6">
                    <h4>Data Integration Guide</h4>
                    <p>
                        Instructions for accessing NBT results through the institutional portal and 
                        integrating data into university systems.
                    </p>
                    <FluentButton Appearance="Appearance.Accent">
                        ‚¨áÔ∏è Download Guide (PDF)
                    </FluentButton>
                </FluentGridItem>
            </FluentGrid>
        </FluentStack>
    </FluentCard>

    <!-- Video Resources -->
    <FluentCard>
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
            <h2>üé• Video Resources</h2>
            <FluentDivider />
            <p>
                Watch informational videos about the NBT, including tutorials, test preparation tips, 
                and guidance for applicants.
            </p>

            <FluentGrid Spacing="3">
                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="8">
                            <div style="font-size: 2rem;">‚ñ∂Ô∏è</div>
                            <h5>Introduction to the NBT</h5>
                            <p style="font-size: 0.9rem;">Overview of what the NBT is and why it matters</p>
                            <FluentButton Appearance="Appearance.Accent">
                                Watch Video
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="8">
                            <div style="font-size: 2rem;">‚ñ∂Ô∏è</div>
                            <h5>Registration Tutorial</h5>
                            <p style="font-size: 0.9rem;">Step-by-step guide to registering online</p>
                            <FluentButton Appearance="Appearance.Accent">
                                Watch Video
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>

                <FluentGridItem xs="12" sm="6" md="4">
                    <FluentCard Style="background: #f3f2f1;">
                        <FluentStack Orientation="Orientation.Vertical" VerticalGap="8">
                            <div style="font-size: 2rem;">‚ñ∂Ô∏è</div>
                            <h5>Test Day Preparation</h5>
                            <p style="font-size: 0.9rem;">What to expect and how to prepare</p>
                            <FluentButton Appearance="Appearance.Accent">
                                Watch Video
                            </FluentButton>
                        </FluentStack>
                    </FluentCard>
                </FluentGridItem>
            </FluentGrid>
        </FluentStack>
    </FluentCard>

    <!-- FAQs -->
    <FluentCard Style="background: #f3f2f1;">
        <FluentStack Orientation="Orientation.Vertical" VerticalGap="12">
            <h3>‚ùì Frequently Asked Questions</h3>
            <p>
                Have questions about the NBT? Check our comprehensive FAQ section or contact us for assistance.
            </p>
            <FluentButton Appearance="Appearance.Accent">
                View FAQs
            </FluentButton>
        </FluentStack>
    </FluentCard>
</FluentStack>

@code {
    private List<DownloadableResourceDto> resources = new();
    private List<DownloadableResourceDto> sampleTests = new();
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        resources = await ResourceService.GetAllAsync();
        sampleTests = resources.Where(r => r.Category == "Sample Questions").ToList();
        isLoading = false;
    }

    private async Task DownloadResource(Guid id, string url)
    {
        await ResourceService.IncrementDownloadCountAsync(id);
        // In a real implementation, trigger file download
    }

    private string FormatFileSize(long? bytes)
    {
        if (!bytes.HasValue || bytes.Value == 0)
            return "Unknown size";

        string[] sizes = { "B", "KB", "MB", "GB" };
        int order = 0;
        double len = bytes.Value;

        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len = len / 1024;
        }

        return $"{len:0.#} {sizes[order]}";
    }
}
